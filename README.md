# Теория вероятностей в RGG или настоящий рандом

## Введение
Часто говорят, что в RGG рандом не настоящий, потому что стримерам часто выпадает одно и то же.
Используя теорию вероятностей, попробуем выяснить насколько такие совпадения вероятны и насколько случайный в RGG рандом.

## Немного теории
### Что такое вероятность?
Вероятность - это число от $0$ до $1$, которое показывает насколько событие вероятно. $0$ - событие невозможно, $1$ - событие обязательно произойдёт.
Вероятность события можно посчитать по формуле:
```math
p(a) = \frac{m}{n}
```
где $m$ - число благоприятных исходов, $n$ - общее число исходов.

### Вероятность противоположных событий
Вероятность противоположного события равна $1$ минус вероятность самого события:
```math
\bar{p}(a) = 1 - p(a)
```
Например, вероятность того что не выпадет крысубль равна:
```math
\bar{p}_{\text{крысубль}} = 1 - \frac{1}{2} = \frac{1}{2}
```

### Вероятность совместных событий
Вероятность совместных событий равна произведению вероятностей событий:
```math
p(a \cap b) = p(a) \cdot p(b)
```
Например, вероятность того что выпадет крысубль два раза подряд или выпадет два крысубля на двух монетках:
```math
p_{\text{крысубль 2 раза}} = \frac{1}{2} \cdot \frac{1}{2} = \frac{1}{4}
```

### Сочетания
[Сочетания](https://ru.wikipedia.org/wiki/Сочетание) - это количество способов выбрать k элементов из n элементов для случая, когда порядок не важен.
```math
{n \choose k} = \frac{n!}{k!(n-k)!}
```
Например, количество способов выбрать 2 участника из 17 участников RGG Land:
```math
{17 \choose 2} = \frac{17!}{2!(17-2)!} = \frac{17!}{2! \cdot 15!} = \frac{17 \cdot 16}{2} = 136
```

### Парадокс дней рождений
[Парадокс дней рождения](https://ru.wikipedia.org/wiki/Парадокс_дней_рождения) похож на проблему восприятия рандома в RGG,
поэтому сначала разберёмся в нём.
Его утверждение состоит в том, что в группе, состоящей из 23 или более человек, вероятность совпадения дней рождения (число и месяц) хотя бы у двух людей превышает 50%.
Такое утверждение может показаться неочевидным, так как вероятность совпадения дней рождения двух человек с любым днём в году $`\frac{1}{365} = 0.27\%`$ умноженная на число человек в группе (23), даёт $`\frac{1}{365} \times 23 = 6.3\%.`$
Для того чтобы на самом деле рассчитать вероятность того, что хотя бы у двух человек совпадёт день рождения,
нужно рассчитать вероятность того, что у всех не совпадёт день рождения, и вычесть из 1.
Возьмём наугад одного человека из группы и запомним его день рождения.
Затем возьмём наугад второго человека, при этом вероятность того, что у него день рождения не совпадёт с днём рождения
первого человека, равна:
```math
1 - \frac{1}{365}
```
Затем возьмём третьего человека; при этом вероятность того, что его день рождения не совпадёт с днём рождения одного из первых двух, равна
```math
1 - \frac{2}{365}
```
Рассуждая по аналогии, мы дойдём до последнего человека, для которого вероятность несовпадения его дня рождения со всеми предыдущими будет равна
```math
1 - \frac{22}{365}
```
Таким образом, вероятность того, что у всех 23 человек дни рождения не совпадут, равна:
```math
\bar{p}(23) = 1 \cdot \Bigl(1 - \frac{1}{365}\Bigr) \cdot \Bigl(1 - \frac{2}{365}\Bigr) \cdot \ldots \cdot \Bigl(1 - \frac{22}{365}\Bigr)
= \frac{365 \cdot 364 \cdot 363 \cdot \ldots \cdot 343}{365^{23}} = \frac{365!}{365^{23} \cdot (365 - 23)!} \approx 49.27\%
```
Тогда вероятность того, что хотя бы у двух человек из 23 дни рождения совпадут, равна:
```math
p(22) = 1 - \bar{p}(22) \approx 50.73\%
```
А общая формула для вероятности совпадения дней рождения в группе из n человек выглядит следующим образом:
```math
p(n) = 1 - \bar{p}(n) = 1 - \frac{365!}{365^n \cdot (365 - n)!}
```
В группе из 23 человек вероятность совпадения дней рождения у двух человек такая высокая,
потому что рассматривается вероятность совпадения дней рождения у любых двух человек в группе.
Эта вероятность определяется количеством пар людей, которые можно составить из 23 человек.
Так как порядок людей в парах не имеет значения, общее число таких пар равно числу сочетаний из 23 по 2, то есть:
```math
\frac{23 \times 22}{2} = 253
```

Распространённое заблуждение состоит в том, что этот случай путают с другим случаем,
когда из группы выбирается один человек и оценивается вероятность того,
что день рождения каких-либо других членов группы совпадёт с днём рождения выбранного человека.
В последнем случае вероятность совпадения значительно ниже.

### Биноминальное распределение
[Биноминальное распределение](https://ru.wikipedia.org/wiki/Биномиальное_распределение) позволяет найти вероятность того,
что событие произойдёт ровно k раз в n независимых испытаниях с постоянной вероятностью p.
Формула биномиального распределения выглядит следующим образом:
```math
p(x = k) = \binom{n}{k} \cdot p^k \cdot (1 - p)^{n - k}
```
- p — вероятность того, что событие **произойдёт** в одном испытании.
- 1 - p — вероятность того, что событие **не произойдёт** в одном испытании.
- n — общее количество испытаний.
- k — количество успешных исходов, которое нас интересует.

Если вероятность выпадения крысубля при подбрасывании монеты равна p = 1/2 и мы подбрасываем монетку 10 раз,
то вероятность того, что крысубль выпадет **ровно** 6 раз:
```math
p(x = 6) = \binom{10}{6} \cdot \Bigl(\frac{1}{2}\Bigr)^6 \cdot \Bigl(1 - \frac{1}{2}\Bigr)^{10 - 6} = \frac{105}{512} \approx 20.5\%
```

## Примеры из RGG
### Пример 1 - Игры
17 участников сезона RGG роллят игры из спецролла **Souls-like**, в котором 34 игры,
какая вероятность того что у двух участников выпадет одна и та же игра?
Какая вероятность того, что будет три и более пары участников играющих в одинаковые игры?

#### 1. Найдём вероятность того, что ни одной паре участников не выпадет одна и та же игра
Вероятность можно найти таким же способом, как и в примере с днями рождения:
```math
p_{\text{все игры разные}} = 1 \cdot \Bigl(1 - \frac{1}{34}\Bigr) \cdot \Bigl(1 - \frac{2}{34}\Bigr) \cdot \ldots \cdot \Bigl(1 - \frac{16}{34}\Bigr)
= \frac{34 \cdot 33 \cdot 32 \cdot \ldots \cdot 18}{34^{17}} = \frac{34!}{34^{17} \cdot (34 - 17)!} \approx 0.77\%
```

#### 2. Вероятность того, что хотя бы у двух участников выпадет одна и та же игра
```math
p_{\text{игра совпала}} = 1 - p_{\text{все игры разные}} \approx 99.23\%
```

#### 3. Найдём вероятность того, что ровно одной паре выпадет одинаковая игра

Нужно найти вероятность того, что одной паре участников выпадет одна и та же игра, а остальные игры будут разными.
Сначала найдём количество возможных пар участников по формуле сочетаний:
```math
{17 \choose 2} = \frac{17!}{2!(17-2)!} = \frac{17 \cdot 16}{2} = 136
```
В качестве игр может быть любая из 36 игр, а количество способов выбрать одну игру из 36 равно 36.
Оставшиеся 15 участников должны выбрать разные игры, найдём количество способов выбрать 15 игр из 35 оставшихся,
порядок в данном случае важен, так как участники роллят игры последовательно:
```math
\frac{33!}{(33 - 15)!} = \frac{33!}{18!}
```
Общее количество способов, как 17 участников могут получить себе игры из 34 игр — $`34^{17}`$.
Для того чтобы найти вероятность того, что ровно одной паре участников выпадет одна и та же игра, нужно умножить количество возможных пар
на количество способов выбрать одну игру из 34, количество способов выбрать 15 разных игр из 33 и поделить на общее количество способов выбрать 17 игр из 34:
```math
p_{\text{одна пара}} = \frac{34 \cdot {17 \choose 2} \cdot \frac{33!}{(33 - 15)!}}{34^{17}} \approx 5.78\%
```

#### 4. Найдём вероятность того, что ровно двум парам выпадут одинаковые игры
Нужно найти вероятность того, что двум парам участников выпадут одни и те же игры, а остальные игры будут разными.
Тут два варианта: либо две пары играют в одну и ту же игру, либо одна пара играет в одну игру, а другая пара в другую.
Сначала найдём количество возможных пар участников.
Сначала для первой пары:
```math
{17 \choose 2} = \frac{17 \cdot 16}{2} = 136
```
Для второй пары:
```math
{15 \choose 2} = \frac{15 \cdot 14}{2} = 105
```
Способов выбрать две игры для двух пар из 34 игр (порядок не важен при выборе двух игр):
```math
{34 \choose 2} = \frac{34 \cdot 33}{2} = 561
```
Оставшиеся 13 участников должны выбрать разные игры, найдём количество способов выбрать 13 игр из 35 оставшихся, порядок так же важен:
```math
\frac{33!}{(33 - 13)!} = \frac{33!}{20!}
```
Для случая когда одна пара играет в одну игру:
```math
p_{\text{две игры}} = \frac{{34 \choose 2} \cdot {17 \choose 2} \cdot {15 \choose 2} \cdot \frac{32!}{(32 - 13)!}}{34^{17}} \approx 15.98\%
```
Для случая когда две пары играют в одну игру:
```math
p_{\text{одна игра}} = \frac{34 \cdot {17 \choose 2} \cdot {15 \choose 2} \cdot \frac{33!}{(33 - 13)!}}{34^{17}} \approx 1.60\%
```
```math
p_{\text{две пары}} = p_{\text{две игры}} + p_{\text{одна игра}} \approx 17.58\%
```

#### 5. Найдём вероятность того, что будет три и более пары участников играющих в одинаковые игры
```math
p_{\text{три и более пары}} = p_{\text{игра совпала}} - p_{\text{одна пара}} - p_{\text{две пары}} \approx 76.44\%
```

#### Вывод
Для маленьких спецроллов на RGG, которые крутят все участники, вероятность того, что у двух участников выпадет одна и та же игра,
практически равна 100%. А три и более игры, в которые играют минимум по два участника, мы будем видеть
приблизительно в трёх случаях из четырёх.
Примерно это мы и наблюдали на RGG Land Chix 2 для спецролла **Souls-like**.

### Пример 2 - Колеса
В колесе добра 1600 пунктов, 16 стримера крутят по 200 колёс, а один — 500 (Привет, Игорь!).
Какая вероятность того, что один пункт колеса выпадет 7 или более участникам?
Какая вероятность, что 10 и более пунктов колеса выпадут 7 участникам или более?

#### 1. Найдём вероятность того, что конкретный пункт выпадет ровно 7 участниками
Для этого используем биноминальное распределение:
```math
p(x = 7) = \binom{17}{7} \cdot (p_{200})^6 \cdot (p_{500}) \cdot (1 - p_{200})^{17 - 7}
```
Где:
  - $` p_{200} = \frac{200}{1600} = \frac{1}{8}`$ — вероятность того, что конкретный пункт выпадет одному из 16 участников, крутящему $200$ колес.
  - $`p_{500} = \frac{500}{1600} = \frac{5}{16}`$ — вероятность того, что конкретный пункт выпадет участнику, крутящему $500$ колес.

```math
p(x = 7) = \binom{17}{7} \cdot \Bigl(\frac{1}{8}\Bigr)^6 \cdot \Bigl(\frac{5}{16}\Bigr) \cdot \Bigl(\frac{7}{8}\Bigr)^{10} \approx 0.61\%
```

#### 2. Найдём вероятность того, что конкретный пункт не выпадет ровно 7 участникам
```math
p(x \neq 7) = 1 - p(x = 7) = 1 - 0.0061 \approx 99.39\%
```
#### 3. Найдём вероятность того, что ни один из 1600 пунктов не выпадет ровно 7 участникам
```math
p_\text{ни один}(x = 7) = \bigl(p(x \neq 7)\bigr)^{1600} = 0.9939^{1600} \approx 0.0056\%
```

#### 4. Найдём вероятность того, что хотя бы один пункт выпадет ровно 7 участникам
Противоположное событие:
```math
p_{\text{хотя бы один}}(x = 7) = 1 - p_\text{ни один}(x = 7) \approx 99.9944\%
```

#### 5. Найдём вероятность того, что конкретный пункт выпадет 7 раз или более
Сложим вероятности того, что конкретный пункт выпадет ровно 7 раз, 8 раз, 9, и так до до 17:
```math
p(x \geq 7) = \sum_{k=7}^{17} \binom{17}{k} \cdot (p_{200})^{k-1} \cdot (p_{500}) \cdot (1 - p_{200})^{17 - k} \approx 0.74\%
```

#### 6. Найдём вероятность того, что конкретный пункт не выпадет 7 раз или более
```math
p(x < 7) = 1 - p(x \geq 7) = 1 - 0.0074 \approx 99.26\%
```
Это означает, что хотя бы 1 пункт **неизбежно** выпадет хотя бы 7 участникам.

#### 7. Найдём вероятность того, что меньше 10 пунктов выпадут 7 раз или более
Просуммируем вероятности того, что ровно 0 пунктов выпадут 7 раз или более, ровно 1, ровно 2, ровно 3, и так до 9:
```math
p_{\text{меньше 10 таких пунктов}} = \sum_{k=0}^{9} \binom{1600}{k} \cdot (p(x \geq 7))^k \cdot (p(x < 7))^{1600 - k} \approx 26.11\%
```

#### 8. Найдём вероятность того, что 10 и более пунктов выпадут 7 раз или больше
```math
p_{\text{10 и более пунктов}} = 1 - p_{\text{меньше 10 таких пунктов}} = 1 - 0.2611 \approx 73.89\%
```

#### Вывод
Если участники будут крутить примерно по 200 колёс добра, а один из участников — значительно больше, то вероятность того, что один пункт колеса выпадет хотя бы 7 участникам, близка к 100%. А примерно в трёх случаях из четырёх таких пунктов будет 10 и более.

## Эксперименты XD
Проведем симуляцию крутки колёс добра на основе статистики прошедшего сезона RGG Chix 2, чтобы сопоставить ее с финальной статистикой самого сезона.
Для генерации списка открученных колес будем использовать Random Sequence Generator из [random.org](https://www.random.org/sequences/).
На самом деле следует проводить ряд таки симуляций и сопоставлять данные с усредненным количеством совпадений, но из-за ограничения на количество обращений к API random.org мы ограничимся одной симуляцией.
Для этого возьмем финальную [статистику](https://rgg.land/stats) прошедшего сезона RGG Chix2
| Участник       | Колёс Добра |
|:-------------- |:----|
| aLySQuE        | 255|
| Charmy_Games   | 139|
| Ditoshey       | 236|
| HellKoty       | 159|
| HiganBanban    | 372|
| HoriKouma      | 166|
| Koordinata     | 313|
| MariTerryCore  | 361|
| MsJudi         | 361|
| nedrugaya      | 116|
| nyamuras       | 409|
| PeaceDaria     | 161|
| pepelnayaa     | 145|
| RUSTY          | 101|
| sad_moustache  | 323|
| Sieliya_Farres | 523|
| Zhem           | 230|
| Всего          | 4370|

Для каждого участника сгенерируем список колёс добра, которые он накрутил за сезон: с помощью Random Sequence Generator сгенерируем свою последовательность чисел от 1 до 1680 в случайном порядке, и возьмем от нее столько первых чисел, сколько колёс накрутил участник.
После этого посчитаем количество одинаковых пунктов колеса среди всех участников и выберем 20 самых популярных.
Вот что получилось, код и детали самой симуляции можно посмотреть в [этом файле](rggchix2.ipynb):
| Пункт | Количество |
| :--- | :--- |
| Паровоз | 9 |
| Moujiks | 9 |
| Привет от разработчика | 7 |
| Ебаный сыр | 7 |
| Бумеранг | 7 |
| Эффектный Сундук | 7 |
| Максимальный риск | 7 |
| Enter the Gungeon | 7 |
| Чури цыганского барона | 7 |
| Лампа Джинна | 7 |
| Дейликовая удача | 6 |
| Зелье трансфигурации | 6 |
| Проверка на реакцию, ага | 6 |
| Колесный магнат | 6 |
| Античитерский кубический комитет | 6 |
| Колян? | 6 |
| Благословление цыганского барона | 6 |
| Проклятый старый дом | 6 |
| Тиндер | 6 |
| Гремлин-обжора | 6 |

Сравним эти данные с [финальной статистикой сезона](https://rgg.land/stats):
| Название                          | Количество |
|:----------------------------------|:----------|
| Дроп на NES                       |          8 |
| Зов предков                       |          8 |
| Make ZX Spectrum great again!     |          7 |
| Почему он, а не я?                |          7 |
| Хайверовская мошна                |          7 |
| Пацифист-ран                      |          7 |
| Свежачок                          |          7 |
| <3                                |          7 |
| Привет от Кармика                 |          7 |
| А не надо было дропать            |          7 |

Получилось, что результаты симуляции и реальная статистика сезона очень схожи и дело не в RGG генераторе.

## Заключение
Выходит, Рандом в RGG близок к настоящему, так как статистика [прошлых](https://rgg.land/fall24/stats) [сезонов](https://rgg.land/stats) не противоречит результатам наших теоретических расчётов, а так же почти не отличаются от приведенной статистики симуляции кручения колес на Chix 2. Дополнительно это можно проверить в предстоящем RGG, если предварительно подготовить случайно перемешанные списки колёс добра для каждого участника отдельно и убедиться, что по итогу сезона статистика не будет сильно отличаться от статистики прошедших сезонов, но, кажется, в этом нет необходимости, так как результаты симуляции показали, что даже при другом методе случайной генерации выпавших пунктов колёс, результаты схожи с нашей реальной статистикой.